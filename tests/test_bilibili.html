<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bilibili-like Test Page</title>
    <!-- Simulate stricter CSP like Bilibili might have -->
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' 'unsafe-eval'; object-src 'none';">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f4f5f7;
        }
        .video-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .ad-banner {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
            border-radius: 8px;
        }
        .sidebar {
            position: fixed;
            right: 20px;
            top: 100px;
            width: 200px;
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .nav-bar {
            background: #00a1d6;
            color: white;
            padding: 15px;
            margin: -20px -20px 20px -20px;
            border-radius: 8px 8px 0 0;
        }
        .test-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 10px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="test-status" id="test-status">
        ğŸ”„ Testing extension...
    </div>

    <div class="nav-bar">
        <h1>å“”å“©å“”å“© (ã‚œ-ã‚œ)ã¤ãƒ­ å¹²æ¯~-bilibili (Test Page)</h1>
        <nav>
            <a href="#" style="color: white; margin: 0 10px;">é¦–é¡µ</a>
            <a href="#" style="color: white; margin: 0 10px;">åŠ¨ç”»</a>
            <a href="#" style="color: white; margin: 0 10px;">ç•ªå‰§</a>
            <a href="#" style="color: white; margin: 0 10px;">ç›´æ’­</a>
        </nav>
    </div>

    <div class="ad-banner">
        ğŸš« è¿™æ˜¯ä¸€ä¸ªå¹¿å‘Šæ¨ªå¹… - This is an advertisement banner that should be detected and removed
    </div>

    <div class="video-card">
        <h3>ğŸ“º æ¨èè§†é¢‘ 1</h3>
        <p>è¿™æ˜¯ä¸€ä¸ªè§†é¢‘å¡ç‰‡ï¼ŒåŒ…å«æ ‡é¢˜å’Œæè¿°ã€‚This is a video card with title and description.</p>
        <button onclick="alert('æ’­æ”¾è§†é¢‘!')">æ’­æ”¾</button>
        <button onclick="alert('æ”¶è—')">æ”¶è—</button>
    </div>

    <div class="video-card">
        <h3>ğŸ“º æ¨èè§†é¢‘ 2</h3>
        <p>å¦ä¸€ä¸ªè§†é¢‘å¡ç‰‡ï¼Œå…·æœ‰äº¤äº’åŠŸèƒ½ã€‚Another video card with interactive features.</p>
        <button onclick="alert('æ’­æ”¾è§†é¢‘!')">æ’­æ”¾</button>
        <button onclick="alert('åˆ†äº«')">åˆ†äº«</button>
    </div>

    <div class="ad-banner" style="background: #ffeb3b; color: #333;">
        ğŸš« ä¾§è¾¹æ å¹¿å‘Š - Sidebar advertisement content
    </div>

    <div class="video-card">
        <h3>ğŸ“º æ¨èè§†é¢‘ 3</h3>
        <p>ç¬¬ä¸‰ä¸ªè§†é¢‘å¡ç‰‡ï¼ŒåŒ…å«æ›´å¤šå†…å®¹ã€‚Third video card with more content.</p>
        <button onclick="alert('æ’­æ”¾è§†é¢‘!')">æ’­æ”¾</button>
        <button onclick="alert('å…³æ³¨UPä¸»')">å…³æ³¨UPä¸»</button>
    </div>

    <div class="sidebar">
        <h4>ğŸ”§ æ‰©å±•æµ‹è¯•</h4>
        <p>è¿™ä¸ªä¾§è¾¹æ ç”¨äºæµ‹è¯•æ‰©å±•åŠŸèƒ½ã€‚</p>
        <button onclick="checkExtensionStatus()" style="width: 100%; padding: 8px; margin: 5px 0;">æ£€æŸ¥æ‰©å±•çŠ¶æ€</button>
        <button onclick="testPing()" style="width: 100%; padding: 8px; margin: 5px 0;">æµ‹è¯•Ping</button>
        <div id="extension-info" style="font-size: 12px; margin-top: 10px;"></div>
    </div>

    <script>
        console.log('ğŸ§ª Bilibili-like test page loaded');
        console.log('Page URL:', window.location.href);
        console.log('Chrome runtime available:', !!chrome?.runtime);

        function updateStatus(message, isError = false) {
            const status = document.getElementById('test-status');
            status.textContent = message;
            status.style.background = isError ? '#e74c3c' : '#27ae60';
        }

        function checkExtensionStatus() {
            const info = document.getElementById('extension-info');
            let html = '<strong>Extension Status:</strong><br>';
            
            html += `Chrome Runtime: ${!!chrome?.runtime}<br>`;
            html += `Content Loaded: ${!!window.webRefactorContentLoaded}<br>`;
            html += `Content Instance: ${!!window.webRefactorContent}<br>`;
            html += `Content Error: ${window.webRefactorContentError || 'None'}<br>`;
            
            if (chrome?.runtime?.onMessage) {
                html += `Message Listeners: ${chrome.runtime.onMessage.hasListeners()}<br>`;
            }
            
            html += `Time: ${new Date().toLocaleTimeString()}`;
            
            info.innerHTML = html;
            
            console.log('=== Extension Status Check ===');
            console.log('webRefactorContentLoaded:', window.webRefactorContentLoaded);
            console.log('webRefactorContent:', window.webRefactorContent);
            console.log('webRefactorContentError:', window.webRefactorContentError);
        }

        function testPing() {
            if (!window.webRefactorContent && !window.webRefactorContentLoaded) {
                alert('âŒ æ‰©å±•æœªåŠ è½½ - Extension not loaded');
                return;
            }

            // Try to ping the extension
            try {
                if (window.webRefactorContent) {
                    window.webRefactorContent.handleMessage(
                        { action: 'ping' },
                        null,
                        (response) => {
                            console.log('Direct ping response:', response);
                            if (response?.pong) {
                                alert('âœ… ç›´æ¥PingæˆåŠŸ! Direct ping successful!');
                            } else {
                                alert('âš ï¸ ç›´æ¥Pingå¼‚å¸¸å“åº” Unexpected ping response: ' + JSON.stringify(response));
                            }
                        }
                    );
                } else {
                    alert('âš ï¸ æ‰©å±•å·²åŠ è½½ä½†å®ä¾‹ä¸å¯ç”¨ Extension loaded but instance not available');
                }
            } catch (error) {
                console.error('Ping test failed:', error);
                alert('âŒ Pingæµ‹è¯•å¤±è´¥: ' + error.message);
            }
        }

        // Auto-check extension status periodically
        setInterval(() => {
            if (window.webRefactorContentLoaded) {
                updateStatus('âœ… æ‰©å±•å·²åŠ è½½ Extension Loaded');
            } else if (window.webRefactorContentError) {
                updateStatus('âŒ æ‰©å±•é”™è¯¯: ' + window.webRefactorContentError, true);
            } else {
                updateStatus('ğŸ”„ ç­‰å¾…æ‰©å±•åŠ è½½ Waiting for Extension...');
            }
        }, 2000);

        // Initial status check
        setTimeout(checkExtensionStatus, 1000);
    </script>
</body>
</html>